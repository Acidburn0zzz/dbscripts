#!/bin/bash

. "$(dirname $0)/db-functions"
. "$(dirname $0)/config"

case "$0" in
    *64)
    _arch="x86_64"
    ;;
    *)
    _arch="i686"
    ;;
esac

cd "${WORKDIR}"
/usr/bin/svn checkout -N $SVNREPO checkout
cd checkout

for pkg in $*; do
    moved=0
    /usr/bin/svn up -q ${pkg}
    if [ -f "${pkg}/repos/testing-${_arch}/PKGBUILD" ]; then
        for repo in core extra; do
            if [ -f "${pkg}/repos/${repo}-${_arch}/PKGBUILD" ]; then
                msg "Moving package '${pkg}': testing-${_arch} -> ${repo}-${_arch}"
                $(dirname $0)/db-move "${pkg}" "testing" "${repo}" "${_arch}"
                moved=1
                break
            fi
        done
        if [ ${moved} -eq 0 ]; then
            warning "${pkg} is only in testing-${_arch}, cannot determine where to move it"
        fi
    else
        warning "${pkg} is not in testing-${_arch}"
    fi
done
