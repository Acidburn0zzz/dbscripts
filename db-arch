#!/bin/bash
# $Id: db-arch,v 1.2 2002/11/28 08:33:44 judd Exp $

echo "==> Updating ABS Tree..." >&2
cd /usr
CVSROOT=:ext:judd@cvs.archlinux.org:/home/cvs-arch cvs -q export -r CURRENT -f arch/build
rm -rf /usr/abs && mv arch/build /usr/abs
rmdir arch

echo "==> Rebuilding HTML Package List..." >&2
cd /usr/abs
rm -f packages.txt
/root/bin/htmlpkglist
mv pkgs_name.html pkgs_cat.html /home/sites/archlinux/htdocs/

echo "==> Generating Text Package List..." >&2
/root/bin/genpkglist
mv packages.txt /home/ftp/current/setup/packages.txt

echo "==> Generating pacsync2 Database for ARCH..." >&2
/usr/bin/gensync /usr/abs /tmp/current.db.tar.gz
[ -f /tmp/current.db.tar.gz ] && mv -f /tmp/current.db.tar.gz /home/ftp/current
