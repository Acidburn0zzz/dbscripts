#!/bin/bash
# $Id: db-arch,v 1.1 2002/08/21 18:13:14 judd Exp $

echo "==> Updating ABS Tree..." >&2
cd /usr
CVSROOT=:ext:judd@archlinux.org:/home/cvs-arch cvs -q export -r CURRENT -f arch/build
rm -rf /usr/abs && mv arch/build /usr/abs
rmdir arch

echo "==> Rebuilding HTML Package List..." >&2
cd /usr/abs
rm -f packages.txt
/root/bin/htmlpkglist
mv pkgs_name.html pkgs_cat.html /home/httpd/html/

echo "==> Generating pacsync1/setup Database..." >&2
/root/bin/gensyncdb

cp /home/ftp/current/pacsync/pacsync.db /home/ftp/current/setup/packages.txt

echo "==> Generating pacsync2 Database for ARCH..." >&2
/usr/bin/gensync /usr/abs /tmp/current.db.tar.gz
[ -f /tmp/current.db.tar.gz ] && mv -f /tmp/current.db.tar.gz /home/ftp/current
